<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Game Items Price Tracker</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 20px;
			}
			.container {
				background: white;
				border-radius: 12px;
				box-shadow: 0 10px 40px rgba(0,0,0,0.3);
				padding: 30px;
				max-width: 800px;
				width: 100%;
			}
			h1 {
				text-align: center;
				color: #2c3e50;
				margin-bottom: 25px;
				font-size: 28px;
			}
			.info-panel {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 15px;
				margin-bottom: 25px;
				padding: 20px;
				background: #f8f9fa;
				border-radius: 8px;
				border: 2px solid #e9ecef;
			}
			.info-box {
				padding: 15px;
				background: white;
				border-radius: 6px;
				box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			}
			.info-box h3 {
				font-size: 14px;
				color: #6c757d;
				margin-bottom: 8px;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}
			.info-value {
				font-size: 24px;
				font-weight: bold;
				color: #2c3e50;
				display: flex;
				align-items: center;
				gap: 10px;
			}
			.countdown {
				color: #3498db;
			}
			.timestamp-container {
				display: flex;
				flex-direction: column;
				gap: 5px;
			}
			.timestamp {
				font-size: 16px;
				color: #495057;
			}
			.time-ago {
				font-size: 14px;
				color: #6c757d;
			}
			.status-icon {
				width: 24px;
				height: 24px;
				flex-shrink: 0;
			}
			.checkmark {
				color: #28a745;
				font-size: 24px;
				font-weight: bold;
			}
			.x-mark {
				color: #dc3545;
				font-size: 24px;
				font-weight: bold;
			}
			.image-container {
				text-align: center;
				margin-top: 20px;
			}
			.image-container img {
				max-width: 100%;
				height: auto;
				border-radius: 8px;
				box-shadow: 0 4px 12px rgba(0,0,0,0.15);
			}
			.loading {
				text-align: center;
				color: #6c757d;
				padding: 40px;
			}
			@media (max-width: 600px) {
				.info-panel {
					grid-template-columns: 1fr;
				}
				.container {
					padding: 20px;
				}
				h1 {
					font-size: 22px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Avakot's Gots Tracker</h1>
			<div class="info-panel">
				<div class="info-box">
					<h3>Next Update In</h3>
					<div class="info-value countdown" id="countdown">Loading...</div>
				</div>
				<div class="info-box">
					<h3>Last Updated</h3>
					<div class="info-value">
						<span id="status-icon"></span>
						<div class="timestamp-container">
							<div class="timestamp" id="timestamp">Loading...</div>
							<div class="time-ago" id="time-ago"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="image-container">
				<img id="game-image" src="" alt="Avakot's Listings" style="display: none;">
				<div class="loading" id="loading">Loading image...</div>
			</div>
		</div>
		<script>
			// Configuration
			const GITHUB_USERNAME = 'Crimson-Crow';
			const GITHUB_REPO = 'salesprout';
			const RELEASE_TAG = 'latest-image';
			const IMAGE_FILENAME = 'image.png';

			function getNextUpdateTime() {
				const now = new Date();
				const hour = now.getUTCHours();
				const nextHour = hour + 3 - (hour % 3);
				const result = new Date(now);
				result.setUTCHours(nextHour, 0, 0, 0);
				return result;
			}

			function updateCountdown() {
				const nextUpdate = getNextUpdateTime();
				const now = new Date();

				const diffSeconds = Math.floor((nextUpdate - now) / 1000);
				const hours = Math.floor(diffSeconds / 3600);
				const minutes = Math.floor((diffSeconds % 3600) / 60);
				const seconds = diffSeconds % 60;

				document.getElementById('countdown').textContent = 
					`${hours}h ${minutes}m ${seconds}s`;
			}

			function formatTimeAgo(date) {
				const now = new Date();
				const diff = now - date;
				const minutes = Math.floor(diff / (1000 * 60));
				const hours = Math.floor(diff / (1000 * 60 * 60));

				if (hours > 0) {
					return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
				} else if (minutes > 0) {
					return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
				} else {
					return 'Just now';
				}
			}

			function isUpToDate(date) {
				return (getNextUpdateTime() - date) <= 3 * 3600000;
			}

			function updateStatus(date) {
				document.getElementById('time-ago').textContent = formatTimeAgo(date);
				const statusIcon = document.getElementById('status-icon');
				if (isUpToDate(date)) {
					statusIcon.innerHTML = '<span class="checkmark">✓</span>';
				} else {
					statusIcon.innerHTML = '<span class="x-mark">✗</span>';
				}
			}

			async function loadImageData() {
				try {
					// Fetch release data from GitHub API
					const response = await fetch(
						`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/releases/tags/${RELEASE_TAG}`
					);
					
					if (!response.ok) {
						throw new Error('Release not found');
					}
					
					const releaseData = await response.json();
					const publishedAt = new Date(releaseData.published_at);
					
					// Update timestamp display
					document.getElementById('timestamp').textContent = 
						publishedAt.toLocaleString('en-US', { 
							month: 'short', 
							day: 'numeric', 
							year: 'numeric',
							hour: 'numeric',
							minute: '2-digit',
							hour12: true
						});

					// Load image with cache buster
					const imageUrl = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO}/releases/download/${RELEASE_TAG}/${IMAGE_FILENAME}?t=${Date.now()}`;
					const img = document.getElementById('game-image');

					img.onload = function() {
						document.getElementById('loading').style.display = 'none';
						img.style.display = 'block';
					};

					img.onerror = function() {
						document.getElementById('loading').textContent = 'Error loading image';
					};

					img.src = imageUrl;

					updateStatus(publishedAt);
					setInterval(() => {
						updateStatus(publishedAt);
					}, 60000);

				} catch (error) {
					console.error('Error loading image data:', error);
					document.getElementById('timestamp').textContent = 'Error';
					document.getElementById('time-ago').textContent = 'Could not load data';
					document.getElementById('loading').textContent = 'Error loading image data';
				}
			}

			// Initialize
			updateCountdown();
			setInterval(updateCountdown, 1000);
			loadImageData();

			// Refresh page at next update time
			setTimeout(() => {
				location.reload();
			}, getNextUpdateTime() - new Date());
		</script>
	</body>
</html>